<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LiveTV!</title>
    <link href="/assert/css/bootstrap.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <link href="/assert/css/index.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <h1>LiveTV! <small>Use Youtube live as IPTV feeds</small></h1>
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">
            Channel Manager
          </h3>
        </div>
        <div class="panel-body">
          <form role="form" action="/api/newchannel" method="POST">
            <div class="form-group">
              <label for="inputChannelName">Name</label>
              <input type="text" class="form-control" id="inputChannelName" name="name">
            </div>
            <div class="form-group">
              <label for="inputChannelCustomID">Custom ID (optional)</label>
              <input type="text" class="form-control" id="inputChannelCustomID" name="custom_id" placeholder="e.g., news, sports, custom-channel">
            </div>
            <div class="form-group">
              <label for="inputChannelLiveURL">URL</label>
              <input type="text" class="form-control" id="inputChannelLiveURL" name="url">
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="proxy">Proxy stream
              </label>
            </div>
            <button type="submit" class="btn btn-default">Add Channel</button>
          </form>
        </div>
        <table class="table table-striped table-condensed">
          <tr>
              <th>#</th>
              <th>Custom ID</th>
              <th>Channel</th>
              <th>Live</th>
              <th>M3U8</th>
              <th>Proxy</th>
              <th></th>
          </tr>
          {{range .Channels}}
          <tr>
              <td>{{.ID}}</td>
              <td>{{ if .CustomID }}{{.CustomID}}{{ else }}-{{ end }}</td>
              <td>{{.Name}}</td>
              <td>{{.URL}}</td>
              <td>{{.M3U8}}</td>
              <td>{{ if .Proxy }}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{{ end }}</td>
              <td><a href="/api/delchannel?id={{.ID}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a></td>
          </tr>
          {{end}}
        </table>
      </div>
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title">
            Config Manager
          </h3>
        </div>
          <div class="panel-body">
            <form role="form" action="/api/updconfig" method="POST">
              <div class="form-group">
                <label for="inputCommand">yt-dlp Command</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="inputCommand" name="cmd" value="{{.Configs.Cmd}}" disabled>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="button" id="allow-edit-button-cmd">Allow Edit</button>
                  </span>
                </div>
              </div>
              <div class="form-group">
                <label for="inputArgs">yt-dlp Args</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="inputArgs" name="args" value="{{.Configs.Args}}" disabled>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="button" id="allow-edit-button-args">Allow Edit</button>
                  </span>
                </div>
              </div>
              <div class="form-group">
                <label for="inputCookiesContent">yt-dlp Cookies Content (optional)</label>
                <textarea class="form-control" id="inputCookiesContent" name="cookies_content" rows="6" placeholder="Paste cookies.txt content here (Netscape format)">{{.Configs.CookiesContent}}</textarea>
                <p class="help-block">The server will save this content to <code>LIVETV_DATADIR/cookies.txt</code> with strict permissions. Leave empty to disable cookies. Export in Netscape format (e.g., using a browser extension such as "Get cookies.txt").</p>
              </div>
              <div class="form-group">
                <label for="inputCookiesDomain">Cookies Domain (required for Cookie header format)</label>
                <input type="text" class="form-control" id="inputCookiesDomain" name="cookies_domain" value="{{.Configs.CookiesDomain}}" placeholder="e.g., .youtube.com">
                <p class="help-block">If you paste a single-line <code>name=value;</code> Cookie header, the server will convert it to Netscape format using this domain.</p>
              </div>
              <div class="form-group">
                <label for="inputYtdlTimeout">yt-dlp Timeout (seconds)</label>
                <input type="number" class="form-control" id="inputYtdlTimeout" name="ytdl_timeout" value="{{.Configs.YtdlTimeout}}" placeholder="e.g., 20">
              </div>
              <div class="form-group">
                <label for="inputBaseURL">BaseURL</label>
                <div class="input-group">
                  <input type="url" class="form-control" id="inputBaseURL" name="baseurl" value="{{.Configs.BaseURL}}">
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="button" id="auto-fill-button">Auto Fill</button>
                  </span>
                </div>
              </div>
              <div class="form-group">
                <label for="inputM3UFilename">M3U Filename</label>
                <input type="text" class="form-control" id="inputM3UFilename" name="m3u_filename" value="{{.Configs.M3UFilename}}" placeholder="e.g., lives.m3u">
              </div>
              <div class="form-group">
                <label for="inputChannelParam">Channel Parameter</label>
                <input type="text" class="form-control" id="inputChannelParam" name="channel_param" value="{{.Configs.ChannelParam}}" placeholder="e.g., c, channel, id">
              </div>
              <div class="form-group">
                <label for="inputTsTimeout">TS Timeout (seconds)</label>
                <input type="number" class="form-control" id="inputTsTimeout" name="ts_timeout" value="{{.Configs.TSTimeout}}" placeholder="e.g., 30">
              </div>
              <button type="submit" class="btn btn-default">Save Config</button>
            </form>
          </div>
      </div>
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title">
            Change Password
          </h3>
        </div>
          <div class="panel-body">
            <form role="form" action="/api/changepwd" method="POST">
              <div class="form-group">
                <label for="inputPassword">New Password</label>
                <div class="input-group">
                  <input type="password" class="form-control" id="inputPassword" name="password">
                </div>
              </div>
              <div class="form-group">
                <label for="inputPassword2">Repeat Password</label>
                <div class="input-group">
                  <input type="password" class="form-control" id="inputPassword2" name="password2">
                </div>
              </div>
              <button type="submit" class="btn btn-default">Change</button>
            </form>
          </div>
      </div>
      <footer class="text-center">
        <a href="https://github.com/qist/livetv">LiveTV!</a> by <a href="https://github.com/qist">qist</a>.
        Made with <span style="color: #e25555;">&hearts;</span> in TK.
        <a href="/log?tail=1" target="_blank" rel="noopener">View Log.</a>
        <a href="/api/logout">Logout.</a>
      </footer>
    </div>
    <script src="/assert/js/jquery.min.js"></script>
    <script src="/assert/js/bootstrap.min.js"></script>
    <script src="/assert/js/bootbox.all.min.js"></script>
    <script>
      $("#auto-fill-button").click(function(){
          $("#inputBaseURL").val(window.location.protocol + "//" + window.location.host)
      });
      $("#allow-edit-button-cmd,#allow-edit-button-args").click(function(){
        bootbox.confirm({
          message: "Warning:This field shall not be manually changed.",
          buttons: {
              confirm: {
                  label: 'Edit Anyway',
                  className: 'btn-danger'
              },
              cancel: {
                  label: 'Okay',
                  className: 'btn-secondary'
              }
          },
          callback: function (result) {
              if(result){
                $('#inputCommand,#inputArgs').prop('disabled', false);
              }
          }
        });
      });
    </script>
  </body>
</html>
